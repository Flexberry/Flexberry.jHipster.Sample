# Метрики и мониторинг
Мониторинг в JHipster реализован с помощью Metrics и Elastic (ELK) Stack .

## Metrics

[Metrics](https://metrics.dropwizard.io/) — это библиотека Java, которая дает вам беспрецедентное представление о том, что ваш код делает в рабочей среде.
Метрики предоставляют мощный набор способов измерения поведения критически важных компонентов в производственной среде.

Благодаря модулям для распространенных библиотек, таких как Jetty, Logback, Log4j, Apache HttpClient, Ehcache, JDBI, Jersey, и механизмам создания отчетов, таким как Graphite, Metrics обеспечивает полную видимость стека.

Центральной библиотекой для Metrics является metrics-core, которая предоставляет некоторые базовые функции:
- Реестры метрик.
- Пять типов метрик: Датчики, Счетчики, Гистограммы, Измерители и Таймеры.
- Отчеты о значениях показателей через JMX, консоль, CSV-файлы и регистраторы SLF4J.

Метрики также предоставляют согласованный и унифицированный способ проверки работоспособности приложений. Проверка работоспособности — это, по сути, небольшая самопроверка, которую приложение выполняет для проверки правильности работы определенного компонента или функции.

Для использования Metrics, достаточно его подключить в зависимостях.

Последняя доступная релизная версия, на момент написания: v4.2.19 от 1 июня 2023.


## Elastic (ELK) Stack 
[Elastic (ELK) Stack ](https://www.elastic.co/elastic-stack/) — набор инструментов, который позволяет надежно и безопасно извлекать данные из любого источника в любом формате, а затем выполняйте поиск, анализ и визуализацию. Инструменты в Elastic Stack предназначены для совместного использования, а выпуски синхронизированы для упрощения процесса установки и обновления. Полный стек инструментов состоит из:
- [Beats](#Beats)
- [APM](#APM)
- [Elasticsearch](#Elasticsearch)
- [Elasticsearch Hadoop](#ElasticsearchHadoop)
- [Kibana](#Kibana)
- [Logstash](#Logstash)

Рассматриваемые версии всех инструментов: 8.8 с недавними обновлениями.


### <a id="Beats">Beats</a>
[Beats](https://www.elastic.co/guide/en/beats/libbeat/8.8/index.html) — это поставщики данных с открытым исходным кодом, которые вы устанавливаете в качестве агентов на свои серверы для отправки данных в Elasticsearch. Доступны для захвата следующие элементы и соответствующие им компоненты:
- Данные аудита — [Auditbeat](https://www.elastic.co/products/beats/auditbeat)
- Лог-файлы и журналы — [Filebeat](https://www.elastic.co/products/beats/filebeat)
- Облачные данные —	[Functionbeat](https://www.elastic.co/products/beats/functionbeat)
- Доступность данных — [Heartbeat](https://www.elastic.co/products/beats/heartbeat)
- Метрики — [Metricbeat](https://www.elastic.co/products/beats/metricbeat)
- Сетевой трафик — [Packetbeat](https://www.elastic.co/products/beats/packetbeat)
- Журналы событий Windows — [Winlogbeat](https://www.elastic.co/products/beats/winlogbeat)

Beats может отправлять данные напрямую в Elasticsearch или через Logstash, где вы можете дополнительно обрабатывать и улучшать данные, прежде чем визуализировать их в Kibana.

Подключение каждого компонента производится в отдельности. Подробнее можно узнать на странице компонента.


### <a id="APM">APM</a>
[APM](https://www.elastic.co/guide/en/apm/guide/8.8/index.html) — это бесплатная и открытая система мониторинга производительности приложений, построенная на Elastic Stack. Позволяет отслеживать программные службы и приложения в режиме реального времени, собирая подробную информацию о производительности по времени отклика на входящие запросы, запросы к базе данных, обращения к кэшам, внешние HTTP-запросы и многое другое. Это позволяет легко выявлять и быстро устранять проблемы с производительностью.

Elastic APM также автоматически собирает необработанные ошибки и исключения. Ошибки группируются в основном на основе трассировки стека, поэтому вы можете идентифицировать новые ошибки по мере их появления и следить за тем, сколько раз возникают определенные ошибки.

Метрики — еще один важный источник информации при отладке производственных систем. Агенты Elastic APM автоматически получают базовые метрики на уровне хоста и метрики, специфичные для агента, такие как метрики JVM в агенте Java и метрики времени выполнения Go в агенте Go.

Подключение АРМ:
1. Настройть интеграцию с APM.
2. Установить APM-агенты.


### <a id="Elasticsearch">Elasticsearch</a>
[Elasticsearch](https://www.elastic.co/guide/en/elasticsearch/reference/8.8/index.html) — это распределенная поисковая и аналитическая система, которая лежит в основе Elastic Stack.

Elasticsearch обеспечивает поиск и аналитику практически в реальном времени для всех типов данных. Независимо от того, структурированный или неструктурированный текст, числовые данные или геопространственные данные, Elasticsearch может эффективно хранить и индексировать их таким образом, чтобы поддерживать быстрый поиск. Позволяет выйти далеко за рамки простого поиска данных и агрегировать информацию, чтобы обнаружить тенденции и закономерности в данных.

Подключение Elasticsearch может осуществляться несколькими способами:
1. С использованием Elastic Cloud.
2. Установить в ОС.
3. Развернуть в Docker-контейнере.

Elasticsearch создан с использованием Java и включает версию OpenJDK в составе каждого дистрибутива. Связанная JVM является рекомендуемой JVM, но есть возможность её изменить.


### <a id="ElasticsearchHadoop">Elasticsearch Hadoop</a>
[Elasticsearch Hadoop](https://www.elastic.co/guide/en/elasticsearch/hadoop/8.8/index.html) — это автономная, самодостаточная небольшая библиотека с открытым исходным кодом, которая позволяет заданиям Hadoop (независимо от того, используют ли Map/Reduce или библиотеки, созданные на ее основе, такие как Hive или Pig, или новые будущие библиотеки, такие как Apache Spark) взаимодействовать с Elasticsearch.

Elasticsearch Hadoop проект, состоящий из двух похожих, но независимых подпроектов с собственным выделенным разделом в документации:
- elasticsearch-hadoop proper — взаимодействие с Elasticsearch из среды Hadoop.
- repository-hdfs — использование HDFS в качестве внутреннего репозитория для создания моментальных снимков/восстановления из/в Elasticsearch.

Подключение Elasticsearch Hadoop происходит через добавление в зависимости или путём скачивания и добавления в проект Java скачанного набора файлов.


### <a id="Kibana">Kibana</a>
[Kibana](https://www.elastic.co/guide/en/kibana/8.8/index.html) — это пользовательский интерфейс, который позволяет визуализировать данные Elasticsearch и перемещаться по Elastic Stack.

Основные функции Kibana:
- Поиск, наблюдение и защита данных. Предоставляются возможности от обнаружения документов до анализа журналов и поиска уязвимостей безопасности и многое другое.
- Анализ данных. Поиск скрытых идей и закономерностей, с помощью визуализации того, что обнаружено в диаграммах, датчиках, картах, графиках и т. д., и объединения их на панели инструментов.
- Управление, контроль и защита Elastic Stack. Управление данными, мониторинг за состоянием кластера Elastic Stack и контроль уровня доступа пользователей.

Самый простой способ использования Kibana - это подключение с использованием Elasticsearch. Кроме того, существует возможность клонирования и изменения исходного кода Kibana.


### <a id="Logstash">Logstash</a>
[Logstash](https://www.elastic.co/guide/en/logstash/8.8/index.html) — это решение с открытым исходным кодом для сбора данных с возможностями конвейерной обработки в реальном времени. Logstash может динамически объединять данные из разрозненных источников и нормализовать данные в нужные места назначения. 

Logstash изначально внедрял инновации в сбор журналов, однако, его возможности выходят далеко за рамки этого варианта использования. Любой тип события можно обогатить и преобразовать с помощью широкого набора входных, фильтрующих и выходных плагинов, а множество собственных кодеков, которые еще больше упрощают процесс регистрации события. Logstash ускоряет получение информации благодаря использованию большего объема и разнообразия данных.

Для полноценной работы Logstash требуется: Java 11 или Java 17 (используется по умолчанию).

Для использования Logstash необходимо его скачать и установить в среде, где развернута Elasticsearch.


## Источники
1. [Metrics User Manual](https://metrics.dropwizard.io/4.2.0/manual/index.html)
2. [Elastic Installation and Upgrade Guide](https://www.elastic.co/guide/en/elastic-stack/current/index.html)