# Система логирования

При генерации проекта нельзя выбрать систему логирования, она настроится автоматически.

В сгенерированном примере используется стандартная для **Spring Boot** система логирования **slf4j** с настройками **logback**.

## Инициализация

Инициализация происходит в файле: 

src/main/java/(...имя пакета...)/config/**LoggingConfiguration.java**

Для логирования используются пакеты **ch.qos.logback** и **org.slf4j**

```java
import ch.qos.logback.classic.LoggerContext;
import org.slf4j.LoggerFactory;

...

LoggerContext context = (LoggerContext) LoggerFactory.getILoggerFactory();

Map<String, String> map = new HashMap<>();
map.put("app_name", appName);
map.put("app_port", serverPort);
String customFields = mapper.writeValueAsString(map);

JHipsterProperties.Logging loggingProperties = jHipsterProperties.getLogging();
JHipsterProperties.Logging.Logstash logstashProperties = loggingProperties.getLogstash();

if (loggingProperties.isUseJsonFormat()) {
    addJsonConsoleAppender(context, customFields);
}
if (logstashProperties.isEnabled()) {
    addLogstashTcpSocketAppender(context, customFields, logstashProperties);
}
if (loggingProperties.isUseJsonFormat() || logstashProperties.isEnabled()) {
    addContextListener(context, customFields, loggingProperties);
}
```

Тут происходит три основных момента:
1. **addJsonConsoleAppender** - инициализация логирования в консоль.
2. **addLogstashTcpSocketAppender** - инициализация сокета слушателя логов для приема логов с фронта.
3. **addContextListener** - инициализация логов настроеных дополнительно.

Если необходимо выбрать и использовать другую систему логирования, то изменения нужно вносить именно в этот файл.

## Файл конфигурации

Файл конфигурации находится по пути: src/main/resources/**logback-spring.xml**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE configuration>

<configuration scan="true">
    <conversionRule conversionWord="crlf" converterClass="com.mycompany.myapp.config.CRLFLogConverter" />
    <property name="CONSOLE_LOG_PATTERN" value="${CONSOLE_LOG_PATTERN:-%clr(%d{${LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd'T'HH:mm:ss.SSSXXX}}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %crlf(%m){red} %n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}"/>
    <property name="FILE_LOG_PATTERN" value="${FILE_LOG_PATTERN:-%d{${LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd HH:mm:ss.SSS}} ${LOG_LEVEL_PATTERN:-%5p} ${PID:- } --- [%t] %-40.40logger{39} : %crlf(%m) %n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}"/>

    <include resource="org/springframework/boot/logging/logback/base.xml"/>

    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>logFile.%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>90</maxHistory>
        </rollingPolicy>
        <encoder>
            <charset>utf-8</charset>
            <Pattern>%d %-5level [%thread] %logger{0}: %msg%n</Pattern>
        </encoder>
    </appender>

    <appender name="ASYNC" class="ch.qos.logback.classic.AsyncAppender">
        <queueSize>512</queueSize>
        <appender-ref ref="FILE"/>
    </appender>

    <root level="${logging.level.root}">
        <appender-ref ref="ASYNC"/>
    </root>

    <logger name="javax.activation" level="WARN"/>
    <logger name="javax.mail" level="WARN"/>

    (...)

    <logger name="LiquibaseSchemaResolver" level="INFO"/>
    <logger name="sun.rmi.transport" level="WARN"/>
    
    <!-- https://logback.qos.ch/manual/configuration.html#shutdownHook and https://jira.qos.ch/browse/LOGBACK-1090 -->
    <shutdownHook class="ch.qos.logback.core.hook.DelayingShutdownHook"/>

    <contextListener class="ch.qos.logback.classic.jul.LevelChangePropagator">
        <resetJUL>true</resetJUL>
    </contextListener>

</configuration>
```

Тут находится конфигурация паттернов сообщений, настройка вывода лога в файл, настройка уровней логирования для отдельных компонентов.

## Ссылки

1. [Все типы appender для logback](https://logback.qos.ch/manual/appenders.html)

2. [Примеры паттернов и настроек spring-boot](https://github.com/spring-projects/spring-boot/blob/v2.7.2/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/logback/defaults.xml)

3. [Системы логирования в Spring React](https://github.com/Flexberry/Flexberry.SpringReactApplication.Sample/blob/main/docs/%D0%A1%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0%20%D0%BB%D0%BE%D0%B3%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.md)

4. [Logback Project](https://logback.qos.ch/)

5. [Simple Logging Facade for Java (SLF4J)](https://www.slf4j.org/)